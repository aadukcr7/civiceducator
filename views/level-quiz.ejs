<%- include('partials/header', { title: level.title + ' Quiz' }) %>

<main class="flex-grow-1">
  <div class="container py-5">
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2">
      <div>
        <h1 class="mb-1"><%= level.title %> Quiz</h1>
        <p class="text-muted mb-0">Attempt the quiz directly anytime.</p>
      </div>
      <div class="d-flex gap-2 flex-wrap">
        <a href="/levels/<%= level.id %>" class="btn btn-outline-secondary">View Lessons</a>
        <a href="/levels" class="btn btn-outline-secondary">All Levels</a>
      </div>
    </div>

    <div class="quiz-section">
      <h3>Take the Quiz</h3>
      <p class="text-muted">Answer all questions. You need 70% to pass.</p>
      <% if (adaptiveDifficulty) { %>
        <p class="text-muted mb-3">
          <strong>Adaptive Mode:</strong> Your next quiz difficulty is set to <%= adaptiveDifficulty %> based on recent performance and completion speed.
        </p>
      <% } %>

      <form method="POST" action="/levels/<%= level.id %>/quiz" id="quizForm">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <% if (level.quiz && level.quiz.length > 0) { %>
          <% level.quiz.forEach((question, qIndex) => { %>
            <div class="quiz-question">
              <h5><strong><%= qIndex + 1 %>.</strong> <%= question.question %></h5>
              <% question.options.forEach((option, oIndex) => { %>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="answers[q<%= question.id %>]" id="q<%= question.id %>_<%= oIndex %>" value="<%= oIndex %>" required>
                  <label class="form-check-label" for="q<%= question.id %>_<%= oIndex %>">
                    <%= option %>
                  </label>
                </div>
              <% }); %>
            </div>
          <% }); %>

          <button type="submit" class="btn btn-primary btn-lg mt-4">Submit Quiz</button>
        <% } else { %>
          <p class="alert alert-warning">No quiz available for this level yet.</p>
        <% } %>
      </form>
    </div>

    <% if (progress && progress.completed) { %>
      <div class="alert alert-success mt-4">
        <strong>âœ“ You have completed this level!</strong><br>
        Score: <%= progress.score %>% | Date: <%= new Date(progress.completed_at).toLocaleDateString() %>
      </div>
    <% } %>
  </div>
</main>

<%- include('partials/footer') %>
